"use strict";var zeZipReader={};(window.zeZipReader=zeZipReader).ZIP_EXTRACTOR_EXTRA_FIELD_SIGNATURE=17754,zeZipReader.ERR_HEADER_PARSE_ERROR="ZIP file is invalid or corrupted",zeZipReader.ERR_HEADER_UNSUPPORTED="ZIP file format is not supported",zeZipReader.ERR_HEADER_BAD_FORMAT="This file does not appear to be a ZIP file",zeZipReader.ERR_HEADER_READ="Error when reading the ZIP header",zeZipReader.ERR_ENTRY_BAD_FORMAT="ZIP entry format error",zeZipReader.ERR_ENTRY_BAD_FORMAT_LOCAL_HEADER="ZIP entry format error (local header)",zeZipReader.ERR_ENCRYPTED="Password-protected ZIP files are not yet supported",zeZipReader.ERR_READ_GETDATA="Error while reading ZIP file array data",zeZipReader.ERR_READ_GETENTRIES="Error while reading ZIP file header",zeZipReader.ERR_INFLATION="Error while decompressing ZIP entry",zeZipReader.CENTRAL_DIRECTORY_HEADER_SIZE=46,zeZipReader.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES=30,zeZipReader.EOCDR_SIZE=22,zeZipReader.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH=12,zeZipReader.ZIP_COMMENT_MAX_LEN=65536,zeZipReader.ZIP64_EOCDR_LOCATOR_SIZE=20,zeZipReader.ZIP64_EXTENSIBLE_DATA_SECTOR_MAX_SIZE=4096,zeZipReader.ZIP64_EOCDR_FIXED_SIZE=56,zeZipReader.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIGNATURE=1,zeZipReader.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIZE=28,zeZipReader.UNICODE_PATH_EXTRA_DATA_SIGNATURE=28789,zeZipReader.UNICODE_COMMENT_EXTRA_DATA_SIGNATURE=25461,zeZipReader.UNICODE_PATH_PREAMBLE_SIZE=5,zeZipReader.AES_EXTRA_DATA_SIGNATURE=39169,zeZipReader.AES_EXTRA_DATA_SIZE=7,zeZipReader.REFERENCE_EXTRA_DATA_SIGNATURE=39171,zeZipReader.REFERENCE_EXTRA_DATA_SIZE=20,zeZipReader.MAX_EOCDR_HEADER_SEEK_LEN=zeZipReader.EOCDR_SIZE+zeZipReader.ZIP_COMMENT_MAX_LEN+zeZipReader.ZIP64_EOCDR_LOCATOR_SIZE+zeZipReader.ZIP64_EXTENSIBLE_DATA_SECTOR_MAX_SIZE+zeZipReader.ZIP64_EOCDR_FIXED_SIZE,zeZipReader.COMPRESSION_MODE_STORE=0,zeZipReader.COMPRESSION_MODE_DEFLATE=8,zeZipReader.COMPRESSION_MODE_ENHANCED_DEFLATE=9,zeZipReader.COMPRESSION_MODE_BZIP=12,zeZipReader.COMPRESSION_MODE_LZMA=14,zeZipReader.COMPRESSION_MODE_REFERENCE=92,zeZipReader.COMPRESSION_MODE_ZSTD=93,zeZipReader.COMPRESSION_MODE_XZ=95,zeZipReader.COMPRESSION_MODE_JPEG=96,zeZipReader.COMPRESSION_MODE_WAVPACK=97,zeZipReader.COMPRESSION_MODE_PPMD=98,zeZipReader.COMPRESSION_MODE_WINZIPENCRYPTED=99,zeZipReader.ZIP_CENTRAL_DIRECTORY_HEADER_SIGNATURE=1347092738,zeZipReader.ZIP_LOCAL_FILE_HEADER_SIGNATURE=1347093252,zeZipReader.ZIP_DATA_DESCRIPTOR_SIGNATURE=1347094280,zeZipReader.ZIP_DATA_ARCHIVE_EXTRA_DATA_SIGNATURE=1347094024,zeZipReader.ZIP_64_EOCDR_DIGITAL_HEADER_SIGNATURE=1347093765,zeZipReader.ZIP_64_EOCDR_SIGNATURE=1347094022,zeZipReader.ZIP_64_EOCDR_LOCATOR_SIGNATURE=1347094023,zeZipReader.EOCDR_SIGNATURE=1347093766,zeZipReader.TEXTDECODER_ASCII=new TextDecoder("ascii"),zeZipReader.TEXTDECODER_UTF8=new TextDecoder("utf-8"),zeZipReader.textDecoderMap={},zeZipReader.CANONICAL_MIME_TYPES={ZIP:"application/zip",ZIP2:"application/x-zip",ZIP3:"application/x-zip-compressed"},zeZipReader.getErrorDetailsFromErrorObject=function(e){var r="";return e&&(r+=e.stack),r},zeZipReader.getFileExtension=function(e){if(null==e)return null;var r=e.lastIndexOf(".");return r==e.length-1?"":e.substring(r+1).toLowerCase().trim()},zeZipReader.startsWith=function(e,r){return 0==e.indexOf(r,0)},zeZipReader.bindFn=function(e,r,i){return e.call.apply(e.bind,arguments)},zeZipReader.isValidUtf8=function(e){for(var r=0,i=0,t=0,a=e.length;t!=e.length;){var E=255&e[t];if(E<=127)t+=1;else{if(194<=E&&E<=223)r=2;else if(224<=E&&E<=239)r=3;else{if(!(240<=E&&E<=244))return!1;r=4}if(a<=t+(r-1))return!1;for(var n=1;n<r;n++)if(128!=(192&e[t+n]))return!1;if(2==r)i=((31&e[t])<<6)+(63&e[t+1]);else if(3==r){if((i=((15&e[t])<<12)+((63&e[t+1])<<6)+(63&e[t+2]))<2048)return!1;if(i>>11==27)return!1}else if(4==r&&((i=((7&e[t])<<18)+((63&e[t+1])<<12)+((63&e[t+2])<<6)+(63&e[t+3]))<65536||1114111<i))return!1;t+=r}}return!0},zeZipReader.getTextDecoder=function(e){"maccyrillic"==e.toLowerCase()&&(e="x-mac-cyrillic");var r=zeZipReader.textDecoderMap[e];return r||(r=new TextDecoder(e),zeZipReader.textDecoderMap[e]=r),r},zeZipReader.decodeStringFromDataView=function(e,r,i,t,a){i=new Uint8Array(e.buffer,r,i);return zeZipReader.decodeStringFromTypedArray(i,t,a)},zeZipReader.decodeStringFromTypedArray=function(e,r,i){try{return i?zeZipReader.getTextDecoder(i).decode(e):(r?zeZipReader.TEXTDECODER_UTF8:zeZipReader.TEXTDECODER_ASCII).decode(e)}catch(e){return ze.log("decode_string_error","misc",e),"Error: "+e}},zeZipReader.postProcessEntryFilenameAndMaybeSkip=function(e,r){var i=!1;return null==e.filename&&(e.filename=""),e.filename=e.filename.replace(/\\/g,"/"),null!=e.filename&&""!=e.filename&&"/"!=e.filename&&"./"!=e.filename&&"."!=e.filename&&".."!=e.filename||(e.directory||0==e.uncompressedSize?i=!0:e.filename="(No name "+r+")"),zeZipReader.startsWith(e.filename,"./")?e.filename=e.filename.substring(2):zeZipReader.startsWith(e.filename,"/")&&(e.filename=e.filename.substring(1)),ze.isSystemFile(e.filename,null,e.directory)&&(i=!0),i},zeZipReader.convertDate=function(e){var r=(4294901760&e)>>16,i=65535&e;try{return new Date(1980+((65024&r)>>9),((480&r)>>5)-1,31&r,(63488&i)>>11,(2016&i)>>5,2*(31&i),0)}catch(e){return null}},zeZipReader.generateSpecialErrorDetailsStringForZipEocdrError=function(e,r,i,t,a){try{var E="Details: ("+zeZipReader.getFileExtension(r)+", "+i;if(!(2<=e.size))return void t(E+")");ze.blobToByteArrayAsync(e,0,2,function(e){e=E+", "+e[0]+", "+e[1]+")";t(e)},a)}catch(e){return void a(e)}},zeZipReader.readHeaderMetadataFromEocdr=function(e,r,i,t,a,E){ze.blobToDataViewAsync(e,Math.max(0,e.size-zeZipReader.MAX_EOCDR_HEADER_SEEK_LEN),e.size,zeZipReader.bindFn(zeZipReader.readZipHeaderRecordMetadata,null,e,r,i,t,a,E),E)},zeZipReader.readZipHeaderRecordMetadata=function(e,r,i,t,a,E,n){try{if(0==n.byteLength)return void E(zeZipReader.ERR_HEADER_PARSE_ERROR+" - ZIP file is empty (zero bytes) and contains no actual data.");if(n.byteLength<zeZipReader.EOCDR_SIZE)return void E(zeZipReader.ERR_HEADER_PARSE_ERROR+" - ZIP file size is not large enough for EOCDR.");for(var R=-1,d=n.byteLength-zeZipReader.EOCDR_SIZE;d<n.byteLength-4;d++)if(n.getUint32(d)==zeZipReader.EOCDR_SIGNATURE){R=d;break}var o,p=0;if(-1==R)for(p=Math.max(0,n.byteLength-zeZipReader.MAX_EOCDR_HEADER_SEEK_LEN);p<n.byteLength-4;p++)n.getUint32(p)==zeZipReader.EOCDR_SIGNATURE&&(R=p);if(-1==R)return void(null==i||i==zeZipReader.CANONICAL_MIME_TYPES.ZIP||i==zeZipReader.CANONICAL_MIME_TYPES.ZIP2||i==zeZipReader.CANONICAL_MIME_TYPES.ZIP3?(o=zeZipReader.ERR_HEADER_PARSE_ERROR+" - Did not find EOCDR signature. Please try re-downloading your ZIP file from the original source.",zeZipReader.generateSpecialErrorDetailsStringForZipEocdrError(e,r,i,function(e){E(o+" - "+e)},function(e){E(o+" - "+e)})):E("This file does not appear to be a ZIP file. Instead, this file's type was detected as: "+i,!1,!0,i,e));if(n.byteLength-R<zeZipReader.EOCDR_SIZE)return void E(zeZipReader.ERR_HEADER_PARSE_ERROR+" - EOCDR not large enough");var _={};if(0<=R-zeZipReader.ZIP64_EOCDR_LOCATOR_SIZE)if(n.getUint32(R-20)==zeZipReader.ZIP_64_EOCDR_LOCATOR_SIGNATURE){_.isZip64=!0;var s=zeZipReader.readUint64FromDataView(n,R-12,!0);if(!Number.isSafeInteger(s))return void E(zeZipReader.ERR_HEADER_UNSUPPORTED+" - ZIP64 EOCDR Relative Offset > MAX_SAFE_INTEGER");var Z=t-s;if(Z<0)return void E(zeZipReader.ERR_HEADER_PARSE_ERROR+" - Zip64 Negative offset from end (last: "+t+", relOffset: "+s+")");var A=n.byteLength-Z;if((_.zip64Index=A)<0)return void E(zeZipReader.ERR_HEADER_PARSE_ERROR+" - Not enough bytes to reverse-seek to ZIP64 EOCDR");if(n.getUint32(A)!=zeZipReader.ZIP_64_EOCDR_SIGNATURE)return void E(zeZipReader.ERR_HEADER_PARSE_ERROR+" - Did not find ZIP64 EOCDR signature where expected");var I=n.getUint32(4+A,!0);if(0<n.getUint32(8+A,!0))return void E(zeZipReader.ERR_HEADER_UNSUPPORTED+" - ZIP64 EocdrSize > Integer.MAX_VALUE, requires long");_.zip64EocdrSize=I;var z=n.getUint16(14+A,!0),D=n.getUint32(16+A,!0),s=n.getUint32(20+A,!0);if(D!=s)return void E(zeZipReader.ERR_HEADER_UNSUPPORTED+" - ZIP64 NumberOfThisDisk != ZIP64 NumberOfTheDiskWithCD");_.zip64NumberOfThisDisk=D,_.zip64NumberOfTheDiskWithStartOfCentralDirectory=s;Z=n.getUint32(24+A,!0);if(0<n.getUint32(28+A,!0))return void E(zeZipReader.ERR_HEADER_UNSUPPORTED+" - ZIP64 TotalEntriesOnDisk > Integer.MAX_VALUE, requires long");_.zip64TotalEntriesOnDisk=Z;D=n.getUint32(32+A,!0);if(0<n.getUint32(36+A,!0))return void E(zeZipReader.ERR_HEADER_UNSUPPORTED+" - ZIP64 TotalEntriesInCd > Integer.MAX_VALUE, requires long");_.zip64TotalEntriesInCd=D;s=n.getUint32(40+A,!0);if(0<n.getUint32(44+A,!0))return void E(zeZipReader.ERR_HEADER_UNSUPPORTED+" - ZIP64 CdSize > Integer.MAX_VALUE, requires long");_.zip64CdSize=s;Z=zeZipReader.readUint64FromDataView(n,48+A,!0);if(!Number.isSafeInteger(Z))return void E(zeZipReader.ERR_HEADER_UNSUPPORTED+" - ZIP64 CdOffsetOfStart > MAX_SAFE_INTEGER");_.zip64CdOffsetOfStart=Z;D=I-zeZipReader.ZIP64_EOCDR_FIXED_SIZE+12;_.zip64ExtensibleDataSectorSize=D}s=n.getUint16(R+4,!0);65535==s&&_.isZip64&&(s=_.zip64NumberOfThisDisk),_.numberOfThisDisk=s;A=n.getUint16(R+6,!0);65535==A&&_.isZip64&&(A=_.zip64NumberOfTheDiskWithStartOfCentralDirectory),_.numberOfTheDiskWithStartOfCentralDirectory=A,_.numAdditionalZipParts=Math.max(s,A);Z=n.getUint16(R+8,!0);_.isZip64&&(65535==Z||0==Z&&62==z)&&(Z=_.zip64TotalEntriesInCd),62==z&&(_.centralDirectoryEncrypted=!0);I=n.getUint32(R+12,!0);4294967295==I&&_.isZip64&&(I=_.zip64CdSize);D=n.getUint32(R+16,!0);4294967295==D&&_.isZip64&&(D=_.zip64CdOffsetOfStart);s=_.isZip64?_.zip64Index:R,A=n.byteLength-s,z=n.getUint16(R+20,!0),s="";return 0<z&&(s=zeZipReader.decodeStringFromDataView(n,R+22,z,!0)),_.numFiles=Z,_.cdrAbsoluteOffset=D,_.cdrSize=I,_.zipFileComment=s,_.eocdrStartDistanceFromEnd=A,_.cdrStartDistanceFromEnd=A+I,void a(_)}catch(e){return e.message||(e.message=""),e.message=zeZipReader.ERR_HEADER_PARSE_ERROR+" - General Error - "+e.message,void E(e)}},zeZipReader.readEntriesFromCentralDirectory=function(e,r,i,t){r.size<e.cdrStartDistanceFromEnd?t(zeZipReader.ERR_HEADER_READ+" - Tail blob size not large enough for CDR"):e.centralDirectoryEncrypted?t("This ZIP file uses Central Directory Encryption which is not supported"):ze.blobToDataViewAsync(r,r.size-e.cdrStartDistanceFromEnd,r.size,zeZipReader.bindFn(zeZipReader.doReadEntriesFromCdr,null,i,t,e.numFiles,!!e.isZip64,e.encoding),t)},zeZipReader.doReadEntriesFromCdr=function(e,r,i,t,a,E){for(var n=0,R=1,d={},o=[],p=[],_=0;_<i;_++){if(E.getUint32(n)!=zeZipReader.ZIP_CENTRAL_DIRECTORY_HEADER_SIGNATURE)return void r(zeZipReader.ERR_HEADER_BAD_FORMAT+" - Expected Header Signature for this file's record");var s={};try{s=zeZipReader.generateEntryFromHeaderRecord(E,n+4,t,a)}catch(e){s.error="Entry Parse Error from CDR: "+e;var Z=zeZipReader.getErrorDetailsFromErrorObject(e);ze.log("entry_parse_error_cdr","zip",(e||"")+" - isZip64: "+t+"; entry.filenameLength: "+s.filenameLength+"; opt_encoding: "+a+"; errDetails: "+Z)}s.referenceData&&(s.compressionMethod!=zeZipReader.COMPRESSION_MODE_REFERENCE?d[zeZipReader.getReferenceUuidFromEntry(s)]=s:o.push(s)),s.error||null!=s.compressionMethod&&(zeZipReader.isZipCompressionMethodSupported(s.compressionMethod)||(s.error="Unsupported ZIP compression method: "+s.compressionMethod,ze.log("entry_unsupported_compression_method","zip",s.compressionMethod))),s.hasAdvancedCompressionMethod=zeZipReader.isCompressionMethodAdvanced(s.compressionMethod),zeZipReader.postProcessEntryFilenameAndMaybeSkip(s,R++)||(s.id=_,p.push(s)),n+=zeZipReader.CENTRAL_DIRECTORY_HEADER_SIZE+s.filenameLength+s.extraFieldLength+s.commentLength}for(var A=0;A<o.length;A++){var I=o[A],z=d[zeZipReader.getReferenceUuidFromEntry(I)];I.referenceData.parentReferent=z,I.referenceData.sha1Start=I.offset,I.referenceData.sha1Size=I.compressedSize,I.offset=z.offset,I.compressedSize=z.compressedSize,I.referenceData.isChildReferent=!0,I.referenceData.originalCompressionMethod=I.compressionMethod,I.compressionMethod=z.compressionMethod;var D,O,S=I.referenceData.crc32;null==S?I.error="Reference Entry Parse Error: CRC32 is required but undefined":(D=new Uint8Array(28),(O=new DataView(D.buffer)).setUint32(0,I.referenceData.originalCompressionMethod,!0),O.setUint32(4,I.lastModDateRaw,!0),O.setUint32(8,I.crc32,!0),z=I.referenceData.uuid,O.setUint32(12,z[0],!1),O.setUint32(16,z[1],!1),O.setUint32(20,z[2],!1),O.setUint32(24,z[3],!1),S!=zeZipReader.computeCrc32Bytes(D)>>>0&&(I.error="Reference Entry Parse Error: CRC32 computation failed"))}o.length=0,d={},e(p)},zeZipReader.getReferenceUuidFromEntry=function(e){e=e.referenceData.uuid;return e[0].toString()+e[1].toString()+e[2].toString()+e[3].toString()},zeZipReader.isZipCompressionMethodSupported=function(e){return e==zeZipReader.COMPRESSION_MODE_DEFLATE||e==zeZipReader.COMPRESSION_MODE_ENHANCED_DEFLATE||e==zeZipReader.COMPRESSION_MODE_STORE||e==zeZipReader.COMPRESSION_MODE_BZIP||e==zeZipReader.COMPRESSION_MODE_LZMA||e==zeZipReader.COMPRESSION_MODE_XZ||e==zeZipReader.COMPRESSION_MODE_PPMD||e==zeZipReader.COMPRESSION_MODE_JPEG||e==zeZipReader.COMPRESSION_MODE_ZSTD||e==zeZipReader.COMPRESSION_MODE_REFERENCE||e==zeZipReader.COMPRESSION_MODE_WINZIPENCRYPTED},zeZipReader.isCompressionMethodAdvanced=function(e){return e==zeZipReader.COMPRESSION_MODE_BZIP||e==zeZipReader.COMPRESSION_MODE_LZMA||e==zeZipReader.COMPRESSION_MODE_XZ||e==zeZipReader.COMPRESSION_MODE_PPMD||e==zeZipReader.COMPRESSION_MODE_JPEG||e==zeZipReader.COMPRESSION_MODE_ZSTD||e==zeZipReader.COMPRESSION_MODE_REFERENCE},zeZipReader.generateEntryFromHeaderRecord=function(e,r,i,t){var a={type:"zip"};a.madeByVersion=e.getUint16(r,!0),a.version=e.getUint16(r+2,!0),a.bitFlag=e.getUint16(r+4,!0),a.compressionMethod=e.getUint16(r+6,!0),a.lastModDateRaw=e.getUint32(r+8,!0),a.lastModDate=0!=a.lastModDateRaw?zeZipReader.convertDate(a.lastModDateRaw):0,zeZipReader.populateEntryEncryptionDetails(a);var E=!1,n=!1,R=!1,d=!1;a.crc32=e.getUint32(r+12,!0),0===a.crc32&&(a.crc32=null),a.compressedSize=e.getUint32(r+16,!0),a.uncompressedSize=e.getUint32(r+20,!0),4294967295!==a.uncompressedSize&&4294967295!==a.compressedSize||(a.isZip64=!0,4294967295===a.uncompressedSize&&(n=!0),4294967295===a.compressedSize&&(E=!0)),a.filenameLength=e.getUint16(r+24,!0),a.extraFieldLength=e.getUint16(r+26,!0),a.commentLength=e.getUint16(r+28,!0);var o=e.getUint16(r+30,!0);65535===o?d=a.isZip64=!0:a.diskNumberStart=o,a.directory=16==(16&e.getUint8(r+34));var p=e.getUint32(r+38,!0);4294967295===p?R=a.isZip64=!0:a.offset=p;o=r+42+a.filenameLength,p=zeZipReader.readExtraFields(e,o,a.extraFieldLength);if(a.isZip64){o=0;if(n&&(o+=8),E&&(o+=8),R&&(o+=8),d&&(o+=4),0<o){if(!(zeZipReader.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIGNATURE in p))return a.error="Did not find ZIP64_EXTENDED_INFO_EXTRA_FIELD for this Zip64 entry.",a;var _=p[zeZipReader.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIGNATURE];if(_.dataSize<o)return a.error="Error: Expected Extra Field Length at least "+o+" for Zip64 Entry, but was: "+_.dataSize,a;_=_.dataStart;if(n){n=zeZipReader.readUint64FromDataView(e,_,!0);if(!Number.isSafeInteger(n))return a.error="Error: ZIP64 Entry Uncompressed Size > MAX_SAFE_INTEGER",a;a.uncompressedSize=n,_+=8}if(E){E=zeZipReader.readUint64FromDataView(e,_,!0);if(!Number.isSafeInteger(E))return a.error="Error: ZIP64 Entry Compressed Size > MAX_SAFE_INTEGER",a;a.compressedSize=E,_+=8}if(R){R=zeZipReader.readUint64FromDataView(e,_,!0);if(!Number.isSafeInteger(R))return a.error="Error: ZIP64 Entry Offset > MAX_SAFE_INTEGER",a;a.offset=R,_+=8}d&&(d=e.getUint32(_,!0),a.diskNumberStart=d,_+=4)}}var s=!1,_=2048==(2048&a.bitFlag);if(zeZipReader.UNICODE_PATH_EXTRA_DATA_SIGNATURE in p){var Z=p[zeZipReader.UNICODE_PATH_EXTRA_DATA_SIGNATURE],A=Z.dataStart+zeZipReader.UNICODE_PATH_PREAMBLE_SIZE,I=Z.dataSize-zeZipReader.UNICODE_PATH_PREAMBLE_SIZE;try{a.filename=zeZipReader.decodeStringFromDataView(e,A,I,!0,void 0),s=!0}catch(e){ze.log("unicode_path_extra_data_parse_error","zip","error: "+e)}}if(!s){var z=new Uint8Array(e.buffer,r+42,a.filenameLength),Z=!1;if(_)Z=!0;else{for(var D=!1,O=0;O<z.length;O++)if(127<z[O]){D=!0,a.filenameHasExtendedChar=!0;break}a.rawFilenameBytes=z,Z=!!D&&zeZipReader.isValidUtf8(z)}a.filename=zeZipReader.decodeStringFromTypedArray(z,Z,t)}if(a.directory||"/"!=a.filename.charAt(a.filename.length-1)||(a.directory=!0),0<a.commentLength?a.comment=zeZipReader.decodeStringFromDataView(e,r+42+a.filenameLength+a.extraFieldLength,a.commentLength,_,void 0):a.comment="",zeZipReader.REFERENCE_EXTRA_DATA_SIGNATURE in p){_=p[zeZipReader.REFERENCE_EXTRA_DATA_SIGNATURE];if(_.dataSize!=zeZipReader.REFERENCE_EXTRA_DATA_SIZE)return a.error="Error: Expected Extra Field Length == 20 for Reference format.",a;a.referenceData={},a.referenceData.crc32=e.getUint32(_.dataStart,!0),a.referenceData.uuid=[e.getUint32(_.dataStart+4,!1),e.getUint32(_.dataStart+8,!1),e.getUint32(_.dataStart+12,!1),e.getUint32(_.dataStart+16,!1)]}if(a.encryptionMode==zeZipReader.ENCRYPTION_MODE_WINZIPAES){if(!(zeZipReader.AES_EXTRA_DATA_SIGNATURE in p))return a.error="Error: Did not find AES Extra Data Record Extra Fields Map.",a;var S=p[zeZipReader.AES_EXTRA_DATA_SIGNATURE];if(S.dataSize<zeZipReader.AES_EXTRA_DATA_SIZE)return a.error="Error: Expected Extra Field Length >= 7 for AES encryption format.",a;var c=null;try{c=zeZipReader.Crypto.Aes.readAesExtraDataRecord(e,S.dataStart)}catch(e){return a.error="Error reading Encryption Data Record: "+e,a}null!=c&&(a.compressionMethod=c.compressionMethod,a.aesKeyStrengthBits=c.keyStrengthBits)}return null==a.crc32&&a.encryptionMode!=zeZipReader.ENCRYPTION_MODE_WINZIPAES&&(a.directory||0==a.uncompressedSize||(a.hasMissingCrc32=!0)),a},zeZipReader.readUint64FromDataView=function(e,r,i){var t=e.getUint32(r,!!i),r=e.getUint32(r+4,!!i);return i?t+Math.pow(2,32)*r:r+Math.pow(2,32)*t},zeZipReader.readExtraFields=function(e,r,i){var t={},a=r;for(null==i&&(i=0);a<r+i;){var E=e.getUint16(a,!0);a+=2;var n=e.getUint16(a,!0);a+=2,E==zeZipReader.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIGNATURE&&((0==n||i<n)&&(n=i-4),28<n&&(n=28));var R={dataStart:a,dataSize:n};a+=n,t[E]=R}return t},zeZipReader.ENCRYPTION_MODE_NONE="none",zeZipReader.ENCRYPTION_MODE_UNKNOWN="unknown",zeZipReader.ENCRYPTION_MODE_PKZIPSTANDARD="pkzipstandard",zeZipReader.ENCRYPTION_MODE_PKZIPSTRONG="pkzipstrong",zeZipReader.ENCRYPTION_MODE_WINZIPAES="winzipaes",zeZipReader.ENCRYPTION_MODE_PKZIPOTHER="pkzipother",zeZipReader.ENCRYPTION_MODE_ENCRYPTEDCDR="encryptedcdr",zeZipReader.populateEntryEncryptionDetails=function(e){e.encryptionMode=zeZipReader.ENCRYPTION_MODE_NONE,e.isEncrypted=1==(1&e.bitFlag),e.hasEncryptedCdr=8192==(8192&e.bitFlag),e.isEncrypted&&(e.hasEncryptedCdr?e.encryptionMode=zeZipReader.ENCRYPTION_MODE_ENCRYPTEDCDR:(e.encryptionMode=zeZipReader.ENCRYPTION_MODE_UNKNOWN,e.compressionMethod==zeZipReader.COMPRESSION_MODE_WINZIPENCRYPTED?e.encryptionMode=zeZipReader.ENCRYPTION_MODE_WINZIPAES:64==(64&e.bitFlag)?e.encryptionMode=zeZipReader.ENCRYPTION_MODE_PKZIPSTRONG:10==e.version||20==e.version||21==e.version||45==e.version||46==e.version||63==e.version||788==e.version||e.compressionMethod==zeZipReader.COMPRESSION_MODE_BZIP||e.compressionMethod==zeZipReader.COMPRESSION_MODE_LZMA||e.compressionMethod==zeZipReader.COMPRESSION_MODE_PPMD?e.encryptionMode=zeZipReader.ENCRYPTION_MODE_PKZIPSTANDARD:e.encryptionMode=zeZipReader.ENCRYPTION_MODE_PKZIPOTHER))},zeZipReader.decompressZipEntry=function(r,e,i,t,a,E,n,R,d,o,p,_,s,Z,A,I,z,D){if(0!=e.byteLength)if(e.byteLength<4)p(zeZipReader.ERR_ENTRY_BAD_FORMAT+" - Not enough bytes in entry data payload for local file signature");else{if(e.getUint32(0)!=zeZipReader.ZIP_LOCAL_FILE_HEADER_SIGNATURE)return D?zeZipReader.ERR_ENTRY_BAD_FORMAT_LOCAL_HEADER:void p(zeZipReader.ERR_ENTRY_BAD_FORMAT+" - Did not find Local File Header signature for this entry. Instead, found bytes: ("+e.getUint8(0)+", "+e.getUint8(1)+", "+e.getUint8(2)+", "+e.getUint8(3)+")");if(e.byteLength<zeZipReader.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES)p(zeZipReader.ERR_ENTRY_BAD_FORMAT+" - Not enough bytes in entry data payload");else{var O=e.getUint16(26,!0),S=e.getUint16(28,!0),c=1==(1&E);if(!c||null!=Z&&0!=Z.length){var C=zeZipReader.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES+O+S,D=null,T=null;if(c){if(null==(D=zeZipReader.processZipEncryptionHeader(d,t,e,C,O,S,p,Z,A)))return;if(T=D.encryptionParams,t=D.newCompressedSize,C=D.newHeaderDataOffset,D.hasAuthenticationCode){A=i+D.authenticationCodeOffset;return void ze.blobToByteArrayAsync(r,A,A+D.authenticationCodeLength,function(e){T.authenticationCodeBytes=e;e=i+C;zeZipReader.decompressZipPayload(r,e,t,a,E,n,R,d,o,p,T,_,s,I,z)},p)}}D=i+C;zeZipReader.decompressZipPayload(r,D,t,a,E,n,R,d,o,p,T,_,s,I,z)}else p(zeZipReader.ERR_INFLATION+" - ZIP file is encrypted but no password was provided")}}else p(zeZipReader.ERR_ENTRY_BAD_FORMAT+" - Empty Entry Data Payload in DataView")},zeZipReader.decompressZipPayload=function(e,r,i,t,a,E,n,R,d,o,p,_,s,Z,A){var I=null,z=null,D={};if(n===zeZipReader.COMPRESSION_MODE_BZIP)I=ze.LIB_BZIP_SCRIPT_NAME,z=ze.CHUNK_SIZE_BZIP;else if(n===zeZipReader.COMPRESSION_MODE_LZMA){if(i<5)return void o("ZIP file LZMA compressedSize must be at least 5, but was: "+i);I=ze.LIB_LZMA_SCRIPT_NAME,z=ze.CHUNK_SIZE_LZMA,t=2==(2&a)?-1:t}else if(n!==zeZipReader.COMPRESSION_MODE_REFERENCE)if(n===zeZipReader.COMPRESSION_MODE_XZ)I=ze.LIB_XZ_SCRIPT_NAME,z=ze.CHUNK_SIZE_XZ;else if(n===zeZipReader.COMPRESSION_MODE_PPMD)I=ze.LIB_PPMDI_SCRIPT_NAME,z=ze.CHUNK_SIZE_PPMDI;else if(n===zeZipReader.COMPRESSION_MODE_JPEG)I=ze.LIB_ZIPJPEG_SCRIPT_NAME,z=ze.CHUNK_SIZE_ZIPJPEG;else if(n===zeZipReader.COMPRESSION_MODE_ZSTD)I=ze.LIB_ZSTD_SCRIPT_NAME,z=ze.CHUNK_SIZE_ZSTD;else{if(n===zeZipReader.COMPRESSION_MODE_WAVPACK)return void o("Unsupported ZIP compression method in decompressZipEntry(): "+n);var O=n==zeZipReader.COMPRESSION_MODE_DEFLATE,S=n==zeZipReader.COMPRESSION_MODE_ENHANCED_DEFLATE,a=n===zeZipReader.COMPRESSION_MODE_STORE;if(!(O||S||a))return void o("Unsupported ZIP compression method; expected Enhanced or Standard DEFLATE, or STORE, but was: "+n);I=ze.LIB_INFLATE_SCRIPT_NAME,S?D.deflate64=!0:a&&(D.stored=!0),z=a?ze.CHUNK_SIZE_COPY:ze.CHUNK_SIZE_INFLATE}ze.genericDecompressWithWorker(new Worker(I),z,e,r,i,t,E,d,o,R,p,D,_,s,!0,Z,void 0,void 0,A)},zeZipReader.processZipEncryptionHeader=function(e,r,i,t,a,E,n,R,d){var o={};if(e==zeZipReader.ENCRYPTION_MODE_PKZIPSTANDARD){o.newCompressedSize=r-zeZipReader.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH;var p=new Int8Array(i.buffer,t,zeZipReader.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH);o.encryptionParams=zeZipReader.Crypto.deriveZipCryptoKeys(p,R),o.newHeaderDataOffset=t+zeZipReader.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH}else{if(e!=zeZipReader.ENCRYPTION_MODE_WINZIPAES)return n("Decryption error: Unsupported encryption mode: "+e),null;if(null==d)return n(zeZipReader.ERR_INFLATION+" - ZIP file is AES password protected but AES Key Strength was not provided"),null;var _=d/16,p=_+zeZipReader.Crypto.Aes.PASSWORD_VERIFIER_LENGTH;if(t+p>i.byteLength)return n("Decryption error: Encrypted Header ("+(t+p)+") extends past dataView ("+i.byteLength+")"),null;var s=new Uint8Array(i.buffer,t,_);try{o.encryptionParams=zeZipReader.Crypto.Aes.initializeWinzipAes(d,s,R)}catch(e){return n(e),null}e=t+_,e=new Uint8Array(i.buffer,e,zeZipReader.Crypto.Aes.PASSWORD_VERIFIER_LENGTH);if(e[0]!=o.encryptionParams.derivedPasswordVerificationBytes[0]||e[1]!=o.encryptionParams.derivedPasswordVerificationBytes[1])return n("Incorrect Password. Password did not match verification bytes."),null;r=r-_-zeZipReader.Crypto.Aes.PASSWORD_VERIFIER_LENGTH-zeZipReader.Crypto.Aes.AUTHENTICATION_CODE_LENGTH;o.newCompressedSize=r;r=t+_+zeZipReader.Crypto.Aes.PASSWORD_VERIFIER_LENGTH+r;o.hasAuthenticationCode=!0,o.authenticationCodeOffset=r,o.authenticationCodeLength=zeZipReader.Crypto.Aes.AUTHENTICATION_CODE_LENGTH,o.newHeaderDataOffset=t+p}return o},zeZipReader.CRC_TABLE=null,zeZipReader.ensureCrc32LookupTableComputed=function(){if(null==zeZipReader.CRC_TABLE){for(var e=new Int32Array(256),r=0;r<256;r++){for(var i=r,t=0;t<8;t++)1==(1&i)?i=i>>>1^3988292384:i>>>=1;e[r]=i}zeZipReader.CRC_TABLE=e}},zeZipReader.computeCrc32Bytes=function(e){zeZipReader.ensureCrc32LookupTableComputed();for(var r=-1>>>0,i=0;i<e.length;i++)r=r>>>8^zeZipReader.CRC_TABLE[255&(r^e[i])];return~r},zeZipReader.Crypto={},zeZipReader.Crypto.ENCRYPTION_HEADER_LENGTH=12,zeZipReader.Crypto.crc32=function(e,r){return e>>>8^zeZipReader.CRC_TABLE[255&(e^r)]},zeZipReader.Crypto.deriveZipCryptoKeys=function(e,r){if(!e||e.length!=zeZipReader.Crypto.ENCRYPTION_HEADER_LENGTH)throw new Error("ZipCrypto error: Encrypted Header must be 12 bytes long");zeZipReader.ensureCrc32LookupTableComputed();var i=new Int32Array(3);i[0]=305419896,i[1]=591751049,i[2]=878082192;for(var t=new Int8Array(1),a=0,E=0;E<r.length;E++)zeZipReader.Crypto.update_keys_from_byte(i,r[E]),a=2|i[2],t[0]=Math.imul(a,1^a)>>>8;for(var n=new Int8Array(zeZipReader.Crypto.ENCRYPTION_HEADER_LENGTH),R=0;R<zeZipReader.Crypto.ENCRYPTION_HEADER_LENGTH;R++)n[R]=zeZipReader.Crypto.update_keys_from_byte(i,e[R]^t[0]),a=2|i[2],t[0]=Math.imul(a,1^a)>>>8;var d={};return d.keys=i,d},zeZipReader.Crypto.update_keys_from_byte=function(e,r){return e[0]=zeZipReader.Crypto.crc32(e[0],r),e[1]+=255&e[0],e[1]=Math.imul(e[1],134775813)+1,e[2]=zeZipReader.Crypto.crc32(e[2],e[1]>>24&255),r},zeZipReader.Crypto.decryptChunkBytesInPlaceZipCrypto=function(e,r){var i=r.keys;if(!i||3!=i.length)throw new Error("ZipCrypto error: Decryption keys required for ZipCrypto encryption");for(var t=2|i[2],a=zeZipReader.CRC_TABLE,E=0;E<e.length;E++)e[E]^=Math.imul(t,1^t)>>>8,i[0]=i[0]>>>8^a[255&(i[0]^e[E])],i[1]=Math.imul(i[1]+(255&i[0]),134775813)+1,i[2]=i[2]>>>8^a[255&(i[2]^i[1]>>24)],t=2|i[2]},zeZipReader.Crypto.Aes={},zeZipReader.Crypto.Aes.PASSWORD_VERIFIER_LENGTH=2,zeZipReader.Crypto.Aes.AUTHENTICATION_CODE_LENGTH=10,zeZipReader.Crypto.Aes.VENDOR_ID_SIGNATURE=17729,zeZipReader.Crypto.Aes.EXTRA_DATA_RECORD_LENGTH=11,zeZipReader.Crypto.Aes.AE1_SIGNATURE_BYTE=1,zeZipReader.Crypto.Aes.AE2_SIGNATURE_BYTE=2,zeZipReader.Crypto.Aes.ENCRYPTION_STRENGTH_128=1,zeZipReader.Crypto.Aes.ENCRYPTION_STRENGTH_192=2,zeZipReader.Crypto.Aes.ENCRYPTION_STRENGTH_256=3,zeZipReader.Crypto.Aes.AES_BLOCK_SIZE=16,zeZipReader.Crypto.Aes.PBKDF2_ITERATIONS=1e3,zeZipReader.Crypto.Aes.readAesExtraDataRecord=function(e,r){var i={},t=e.getUint16(r,!0);i.vendorVersion=t,i.encryptionMode=t==zeZipReader.Crypto.Aes.AE1_SIGNATURE_BYTE?"AE-1":t==zeZipReader.Crypto.Aes.AE2_SIGNATURE_BYTE?"AE-2":"Unknown";t=e.getUint16(r+2,!0);if((i.vendorId=t)!=zeZipReader.Crypto.Aes.VENDOR_ID_SIGNATURE)throw new Error('AES Decryption error: Expected "AE" for Vendor ID, instead found: '+t);t=e.getUint8(r+4,!0);if(i.encryptionStrengthMode=t,i.keyStrengthBits=t==zeZipReader.Crypto.Aes.ENCRYPTION_STRENGTH_128?128:t==zeZipReader.Crypto.Aes.ENCRYPTION_STRENGTH_192?192:t==zeZipReader.Crypto.Aes.ENCRYPTION_STRENGTH_256?256:-1,-1==i.keyStrengthBits)throw new Error("AES Decryption error: Invalid AES Encryption Strength: "+i.keyStrengthBits+" ("+i.encryptionStrengthMode+")");return i.compressionMethod=e.getUint16(r+5,!0),i},zeZipReader.Crypto.Aes.initializeWinzipAes=function(e,r,i){var t=e/8,a=t,E=t+a+zeZipReader.Crypto.Aes.PASSWORD_VERIFIER_LENGTH,e=Sha1.pbkdf2(i,r,zeZipReader.Crypto.Aes.PBKDF2_ITERATIONS,E);if(e.length!=E)throw new Error("AES Decryption error: derivedKeyBytes length ("+e.length+") does not match expected ("+E+")");i=e.slice(0,t),r=e.slice(t,t+a),E={};return E.derivedPasswordVerificationBytes=e.slice(t+a,t+a+zeZipReader.Crypto.Aes.PASSWORD_VERIFIER_LENGTH),E.hmac=Sha1.createhmacSha1(r),E.aes=new aesjs.ModeOfOperation.ctr(i,1,!0),E},zeZipReader.Crypto.Aes.verifyWinzipAesAuthenticationCode=function(e,r){var i=r.digest();if(!i||i.length<zeZipReader.Crypto.Aes.AUTHENTICATION_CODE_LENGTH)throw new Error("AES Decryption error: Could not get minimum 10 bytes from final Mac digest to authenticate");for(var t=!0,a=0;a<zeZipReader.Crypto.Aes.AUTHENTICATION_CODE_LENGTH;a++)if(e[a]!=i[a]){t=!1;break}return!!t},zeZipReader.Crypto.Aes.decryptChunkBytesInPlaceWinZipAes=function(e,r){r.hmac.update(e),r.aes.encryptOrDecryptFullChunkInPlaceFast(e)};